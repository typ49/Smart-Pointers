\hypertarget{Shared_8h_source}{}\doxysection{Shared.\+h}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef SP\_SHARED\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define SP\_SHARED\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <stdexcept>} \textcolor{comment}{// Include for std::runtime\_error}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{namespace }sp}
\DoxyCodeLine{10 \{}
\DoxyCodeLine{14   \textcolor{keyword}{struct }\mbox{\hyperlink{structsp_1_1BlockControl}{BlockControl}}}
\DoxyCodeLine{15   \{}
\DoxyCodeLine{16     std::size\_t refCount = 0;  \textcolor{comment}{// Count of Shared pointers}}
\DoxyCodeLine{17     std::size\_t weakCount = 0; \textcolor{comment}{// Count of Weak pointers}}
\DoxyCodeLine{18 }
\DoxyCodeLine{22     \mbox{\hyperlink{structsp_1_1BlockControl_a94ebf24f2c0ce0ceebfb431e626faa83}{BlockControl}}() : refCount(1), weakCount(0) \{\} }
\DoxyCodeLine{23   \};}
\DoxyCodeLine{24 }
\DoxyCodeLine{28   \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{29   \textcolor{keyword}{class }\mbox{\hyperlink{classsp_1_1Shared}{Shared}}}
\DoxyCodeLine{30   \{}
\DoxyCodeLine{31   \textcolor{keyword}{public}:}
\DoxyCodeLine{36     \mbox{\hyperlink{classsp_1_1Shared_a6e89a2e5e193da8fdd612b5c3945c1af}{Shared}}(T *ptr = \textcolor{keyword}{nullptr})}
\DoxyCodeLine{37     \{}
\DoxyCodeLine{38       \textcolor{keywordflow}{if} (ptr)}
\DoxyCodeLine{39       \{}
\DoxyCodeLine{40         m\_ptr = ptr;}
\DoxyCodeLine{41         m\_block = \textcolor{keyword}{new} \mbox{\hyperlink{structsp_1_1BlockControl}{BlockControl}}(); \textcolor{comment}{// Create a new BlockControl instance}}
\DoxyCodeLine{42       \}}
\DoxyCodeLine{43       \textcolor{keywordflow}{else}}
\DoxyCodeLine{44       \{}
\DoxyCodeLine{45         m\_ptr = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{46         m\_block = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{47       \}}
\DoxyCodeLine{48     \}}
\DoxyCodeLine{49 }
\DoxyCodeLine{53     \mbox{\hyperlink{classsp_1_1Shared_a1ea2c9d08dd4e5ef854627ce445d4997}{\string~Shared}}()}
\DoxyCodeLine{54     \{}
\DoxyCodeLine{55       \textcolor{keywordflow}{if} (m\_block \&\& -\/-\/(m\_block-\/>refCount) == 0)}
\DoxyCodeLine{56       \{}
\DoxyCodeLine{57         \textcolor{keyword}{delete} m\_ptr;}
\DoxyCodeLine{58         \textcolor{keywordflow}{if} (m\_block-\/>weakCount == 0)}
\DoxyCodeLine{59         \{}
\DoxyCodeLine{60           \textcolor{keyword}{delete} m\_block;}
\DoxyCodeLine{61         \}}
\DoxyCodeLine{62       \}}
\DoxyCodeLine{63     \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{69     \mbox{\hyperlink{classsp_1_1Shared_af7ca127d9ef2264710868e08f8aa2228}{Shared}}(\mbox{\hyperlink{classsp_1_1Shared}{Shared}} \&\&other) noexcept : m\_block(other.m\_block), m\_ptr(other.m\_ptr)}
\DoxyCodeLine{70     \{}
\DoxyCodeLine{71       other.m\_ptr = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{72       other.m\_block = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{73     \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{80     \mbox{\hyperlink{classsp_1_1Shared}{Shared}} \&\mbox{\hyperlink{classsp_1_1Shared_a7d4a7f79c5ec706fff069246652fdc3d}{operator=}}(\mbox{\hyperlink{classsp_1_1Shared}{Shared}} \&\&other) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{81     \{}
\DoxyCodeLine{82       \textcolor{keywordflow}{if} (\textcolor{keyword}{this} != \&other)}
\DoxyCodeLine{83       \{}
\DoxyCodeLine{84         releaseResources();}
\DoxyCodeLine{85         m\_ptr = other.m\_ptr;}
\DoxyCodeLine{86         m\_block = other.m\_block;}
\DoxyCodeLine{87         other.m\_ptr = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{88         other.m\_block = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{89       \}}
\DoxyCodeLine{90       \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{91     \}}
\DoxyCodeLine{92 }
\DoxyCodeLine{97     \mbox{\hyperlink{classsp_1_1Shared_a1448328f8a5ae9af7c274a66969e5a15}{Shared}}(\textcolor{keyword}{const} \mbox{\hyperlink{classsp_1_1Shared}{Shared}} \&other) : m\_block(other.m\_block), m\_ptr(other.m\_ptr)}
\DoxyCodeLine{98     \{}
\DoxyCodeLine{99       \textcolor{keywordflow}{if} (m\_block)}
\DoxyCodeLine{100       \{}
\DoxyCodeLine{101         ++(m\_block-\/>refCount);}
\DoxyCodeLine{102       \}}
\DoxyCodeLine{103     \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{110     \mbox{\hyperlink{classsp_1_1Shared}{Shared}} \&\mbox{\hyperlink{classsp_1_1Shared_a2ecec2a01c9a4241ab0291a3c2dd1d41}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{classsp_1_1Shared}{Shared}} \&other)}
\DoxyCodeLine{111     \{}
\DoxyCodeLine{112       \textcolor{keywordflow}{if} (\textcolor{keyword}{this} != \&other)}
\DoxyCodeLine{113       \{}
\DoxyCodeLine{114         releaseResources();}
\DoxyCodeLine{115         m\_ptr = other.m\_ptr;}
\DoxyCodeLine{116         m\_block = other.m\_block;}
\DoxyCodeLine{117         \textcolor{keywordflow}{if} (m\_block)}
\DoxyCodeLine{118         \{}
\DoxyCodeLine{119           ++(m\_block-\/>refCount);}
\DoxyCodeLine{120         \}}
\DoxyCodeLine{121       \}}
\DoxyCodeLine{122       \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{123     \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{129     T *\mbox{\hyperlink{classsp_1_1Shared_ad48bbaa31b828f9b840b088b054a9636}{get}}()}
\DoxyCodeLine{130     \{}
\DoxyCodeLine{131       \textcolor{keywordflow}{return} m\_ptr;}
\DoxyCodeLine{132     \}}
\DoxyCodeLine{133 }
\DoxyCodeLine{139     T \&\mbox{\hyperlink{classsp_1_1Shared_a181d800696b53f12e6e99577457f9210}{operator*}}()}
\DoxyCodeLine{140     \{}
\DoxyCodeLine{141       \textcolor{keywordflow}{if} (m\_ptr)}
\DoxyCodeLine{142       \{}
\DoxyCodeLine{143         \textcolor{keywordflow}{return} *m\_ptr;}
\DoxyCodeLine{144       \}}
\DoxyCodeLine{145       \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Null pointer exception"{}});}
\DoxyCodeLine{146     \}}
\DoxyCodeLine{147 }
\DoxyCodeLine{152     T *\mbox{\hyperlink{classsp_1_1Shared_a94eba000c52cf05aeb76288de092445d}{operator-\/>}}()}
\DoxyCodeLine{153     \{}
\DoxyCodeLine{154       \textcolor{keywordflow}{return} m\_ptr;}
\DoxyCodeLine{155     \}}
\DoxyCodeLine{156 }
\DoxyCodeLine{161     std::size\_t \mbox{\hyperlink{classsp_1_1Shared_a3dd72cc31f0be97dcf58bac4230a09cd}{count}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{162 \textcolor{keyword}{    }\{}
\DoxyCodeLine{163       \textcolor{keywordflow}{return} m\_block ? m\_block-\/>refCount : 0;}
\DoxyCodeLine{164     \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{170     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classsp_1_1Shared_a53e12ed0218436ead73b1e1ea619c5ba}{exists}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{171 \textcolor{keyword}{    }\{}
\DoxyCodeLine{172       \textcolor{keywordflow}{return} m\_ptr != \textcolor{keyword}{nullptr};}
\DoxyCodeLine{173     \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{179     \textcolor{keyword}{operator} bool()\textcolor{keyword}{ const}}
\DoxyCodeLine{180 \textcolor{keyword}{    }\{}
\DoxyCodeLine{181       \textcolor{keywordflow}{return} \mbox{\hyperlink{classsp_1_1Shared_a53e12ed0218436ead73b1e1ea619c5ba}{exists}}();}
\DoxyCodeLine{182     \}}
\DoxyCodeLine{183 }
\DoxyCodeLine{190     \textcolor{keyword}{template} <\textcolor{keyword}{typename}... Args>}
\DoxyCodeLine{191     \textcolor{keyword}{static} \mbox{\hyperlink{classsp_1_1Shared}{Shared}} \mbox{\hyperlink{classsp_1_1Shared_a922dc84470604df67f9938c53240df05}{makeShared}}(Args \&\&...args)}
\DoxyCodeLine{192     \{}
\DoxyCodeLine{193       \textcolor{keywordflow}{return} \mbox{\hyperlink{classsp_1_1Shared_a6e89a2e5e193da8fdd612b5c3945c1af}{Shared}}(\textcolor{keyword}{new} T(std::forward<Args>(args)...));}
\DoxyCodeLine{194     \}}
\DoxyCodeLine{195 }
\DoxyCodeLine{199     \textcolor{keywordtype}{void} \mbox{\hyperlink{classsp_1_1Shared_aea8ab498312729e968050d9c15e53d76}{reset}}()}
\DoxyCodeLine{200     \{}
\DoxyCodeLine{201       releaseResources();}
\DoxyCodeLine{202       m\_ptr = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{203       m\_block = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{204     \}}
\DoxyCodeLine{205 }
\DoxyCodeLine{206   \textcolor{keyword}{private}:}
\DoxyCodeLine{207     \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{208     \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{classsp_1_1Weak}{Weak}}; \textcolor{comment}{// Allow Weak to access private members}}
\DoxyCodeLine{209     \mbox{\hyperlink{structsp_1_1BlockControl}{BlockControl}} *m\_block = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{210     T *m\_ptr = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{211 }
\DoxyCodeLine{215     \textcolor{keywordtype}{void} releaseResources()}
\DoxyCodeLine{216     \{}
\DoxyCodeLine{217       \textcolor{keywordflow}{if} (m\_block \&\& -\/-\/(m\_block-\/>refCount) == 0)}
\DoxyCodeLine{218       \{}
\DoxyCodeLine{219         \textcolor{keyword}{delete} m\_ptr;}
\DoxyCodeLine{220         \textcolor{keywordflow}{if} (m\_block-\/>weakCount == 0)}
\DoxyCodeLine{221         \{}
\DoxyCodeLine{222           \textcolor{keyword}{delete} m\_block;}
\DoxyCodeLine{223         \}}
\DoxyCodeLine{224       \}}
\DoxyCodeLine{225     \}}
\DoxyCodeLine{226 }
\DoxyCodeLine{232     \mbox{\hyperlink{classsp_1_1Shared_a6e89a2e5e193da8fdd612b5c3945c1af}{Shared}}(T *ptr, BlockControl *block) : m\_block(block), m\_ptr(ptr)}
\DoxyCodeLine{233     \{}
\DoxyCodeLine{234       \textcolor{keywordflow}{if} (m\_block)}
\DoxyCodeLine{235       \{}
\DoxyCodeLine{236         ++m\_block-\/>refCount;}
\DoxyCodeLine{237       \}}
\DoxyCodeLine{238     \}}
\DoxyCodeLine{239   \};}
\DoxyCodeLine{240 }
\DoxyCodeLine{241 \} \textcolor{comment}{// namespace sp}}
\DoxyCodeLine{242 }
\DoxyCodeLine{243 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// SP\_SHARED\_H}}

\end{DoxyCode}
